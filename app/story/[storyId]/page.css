/**
 * Story Page Styles
 *
 * Implements 9:16 aspect ratio container with:
 * - Mobile viewport height fix (--vh custom property)
 * - Safe area insets for notches and home indicators
 * - Touch-action manipulation for tap zones
 * - Black background for immersive viewing
 *
 * @feature 012-standalone-story
 */

/* ============================================================================
 * 9:16 Aspect Ratio Container
 * ============================================================================
/* Story container with 9:16 aspect ratio and safe areas */
.story-container {
  /* Fix mobile viewport height issue */
  height: 100%;
  height: 100dvh; /* Dynamic viewport height (preferred) */
  max-width: 100%;
  max-width: 100dvw;

  /* Fallback for browsers without dvh support */
  @supports not (height: 100dvh) {
    height: calc(var(--vh, 1vh) * 100);
  }

  /* 9:16 aspect ratio enforcement */
  aspect-ratio: 9 / 16;
  width: 100%;
  max-width: 56.25vh; /* 9/16 * 100vh */
  margin: 0 auto;

  /* Background for immersive viewing */
  background-color: #000;
}

/* ============================================================================
 * Safe Area Handling (FR-031, FR-032, FR-033)
 * ============================================================================
 
/* Focal point adjustment for teleprompter (FR-032) */
.teleprompter-focal-point {
  /* Default position without safe area */
  top: 33vh;
  top: 33dvh;

  /* Adjust to 38% when safe area detected */
  @supports (padding-top: env(safe-area-inset-top)) {
    top: 38vh;
    top: 38dvh;
  }
}

.story-content {
  /* Base padding for all slides */
  padding: 2rem;

  /* Apply safe areas if supported */
  padding-top: max(2rem, env(safe-area-inset-top, 0));
  padding-bottom: max(2rem, env(safe-area-inset-bottom, 0));
  padding-left: max(2rem, env(safe-area-inset-left, 0));
  padding-right: max(2rem, env(safe-area-inset-right, 0));
}

/* ============================================================================
 * Touch Interaction
 * ============================================================================
/* Disable default touch actions like zoom, scroll, tap highlighting */
.story-viewer {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  --webkit-tap-highlight-color: transparent;
}

/* Prevent context menu on long press */
.story-viewer {
  -webkit-user-select: none;
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}

/* Prevent rubber-band scrolling */
.story-viewer > div {
  overscroll-behavior: none;
  overscroll-behavior-y: none;
}

/* ============================================================================
 * Loading States
 * ============================================================================
.loading-skeleton {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #000;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: rgba(255, 255, 255, 0.6);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ============================================================================
 * Teleprompter Gradients (FR-012)
 * ============================================================================
*/
.teleprompter-gradients {
  /* Top gradient fade */
  .teleprompter-top-gradient {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 35vh;
    pointer-events: none;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 0%,
      rgba(0, 0, 0, 0.5) 100%
    );
  }

  /* Bottom gradient fade */
  .teleprompter-bottom-gradient {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 35vh;
    pointer-events: none;
    background: linear-gradient(
      to top,
      rgba(0, 0, 0, 0) 0%,
      rgba(0, 0, 0, 0.5) 100%
    );
  }
}

/* ============================================================================
 * Performance Optimizations (FR-035, FR-037, FR-038)
 * ============================================================================
/* GPU acceleration for smooth scrolling */
.teleprompter-content {
  transform: translateZ(0);
  will-change: transform;
}

/* Disable text selection during scrolling to prevent lag (FR-038) */
.is-scrolling {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* ============================================================================
 * Utilities (FR-050, FR-051, FR-052)
 * ============================================================================
/* Content shorter than viewport */
.content-fits-screen {
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Auto-scroll paused indicator */
.auto-scroll-paused {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

/* Auto-scroll paused toast */
.auto-scroll-paused .toast {
  position: absolute;
  bottom: 20%;
  left: 50%;
  transform: translateX(-50%);
  padding: 0.75rem 1.5rem;
  background-color: rgba(0, 0, 0, 0.8);
  border-radius: 0.5rem;
  color: white;
  font-size: 0.875rem;
  line-height: 1.25;
  text-align: center;
  white-space: nowrap;
  pointer-events: none;
  animation: slideUp 0.3s ease-out;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* ============================================================================
 * Pause/Resume Button (FR-025, FR-033)
 * ============================================================================
.play-pause-button {
  position: absolute;
  bottom: 10vh;
  right: 1rem;
  z-index: 40;
}

/* ============================================================================
 * Keyboard Shortcuts (FR-045, FR-046, FR-047)
 * ============================================================================
*/

.keyboard-hint {
  position: absolute;
  bottom: 1rem;
  left: 1rem;
  padding: 0.5rem 1rem;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 0.5rem;
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.75rem;
  line-height: 1.2;
  z-index: 50;
  display: none; /* Only show on keyboard focus */
}

.keyboard-hint:focus {
  display: block;
}
